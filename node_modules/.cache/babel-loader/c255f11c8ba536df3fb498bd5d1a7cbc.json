{"ast":null,"code":"var _jsxFileName = \"/var/www/game.bobba.ca/src/components/inventory/views/furniture/InventoryFurnitureView.tsx\",\n    _s = $RefreshSig$();\n\nimport { RoomObjectVariable, Vector3d } from '@nitrots/nitro-renderer';\nimport { useEffect, useState } from 'react';\nimport { attemptItemPlacement, FurniCategory, GetRoomEngine, GetSessionDataManager, LocalizeText, UnseenItemCategory } from '../../../../api';\nimport { AutoGrid, Button, Column, Grid, LayoutLimitedEditionCompactPlateView, LayoutRarityLevelView, LayoutRoomPreviewerView, Text } from '../../../../common';\nimport { CatalogPostMarketplaceOfferEvent } from '../../../../events';\nimport { DispatchUiEvent, useInventoryFurni, useInventoryUnseenTracker } from '../../../../hooks';\nimport { InventoryCategoryEmptyView } from '../InventoryCategoryEmptyView';\nimport { InventoryFurnitureItemView } from './InventoryFurnitureItemView';\nimport { InventoryFurnitureSearchView } from './InventoryFurnitureSearchView';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst attemptPlaceMarketplaceOffer = groupItem => {\n  const item = groupItem.getLastItem();\n  if (!item) return false;\n  if (!item.sellable) return false;\n  DispatchUiEvent(new CatalogPostMarketplaceOfferEvent(item));\n};\n\nexport const InventoryFurnitureView = props => {\n  _s();\n\n  const {\n    roomSession = null,\n    roomPreviewer = null\n  } = props;\n  const [isVisible, setIsVisible] = useState(false);\n  const [filteredGroupItems, setFilteredGroupItems] = useState([]);\n  const {\n    groupItems = [],\n    selectedItem = null,\n    activate = null,\n    deactivate = null\n  } = useInventoryFurni();\n  const {\n    resetItems = null\n  } = useInventoryUnseenTracker();\n  useEffect(() => {\n    if (!selectedItem || !roomPreviewer) return;\n    const furnitureItem = selectedItem.getLastItem();\n    if (!furnitureItem) return;\n    const roomEngine = GetRoomEngine();\n    let wallType = roomEngine.getRoomInstanceVariable(roomEngine.activeRoomId, RoomObjectVariable.ROOM_WALL_TYPE);\n    let floorType = roomEngine.getRoomInstanceVariable(roomEngine.activeRoomId, RoomObjectVariable.ROOM_FLOOR_TYPE);\n    let landscapeType = roomEngine.getRoomInstanceVariable(roomEngine.activeRoomId, RoomObjectVariable.ROOM_LANDSCAPE_TYPE);\n    wallType = wallType && wallType.length ? wallType : '101';\n    floorType = floorType && floorType.length ? floorType : '101';\n    landscapeType = landscapeType && landscapeType.length ? landscapeType : '1.1';\n    roomPreviewer.reset(false);\n    roomPreviewer.updateObjectRoom(floorType, wallType, landscapeType);\n    roomPreviewer.updateRoomWallsAndFloorVisibility(true, true);\n\n    if (furnitureItem.category === FurniCategory.WALL_PAPER || furnitureItem.category === FurniCategory.FLOOR || furnitureItem.category === FurniCategory.LANDSCAPE) {\n      floorType = furnitureItem.category === FurniCategory.FLOOR ? selectedItem.stuffData.getLegacyString() : floorType;\n      wallType = furnitureItem.category === FurniCategory.WALL_PAPER ? selectedItem.stuffData.getLegacyString() : wallType;\n      landscapeType = furnitureItem.category === FurniCategory.LANDSCAPE ? selectedItem.stuffData.getLegacyString() : landscapeType;\n      roomPreviewer.updateObjectRoom(floorType, wallType, landscapeType);\n\n      if (furnitureItem.category === FurniCategory.LANDSCAPE) {\n        const data = GetSessionDataManager().getWallItemDataByName('noob_window_double');\n        if (data) roomPreviewer.addWallItemIntoRoom(data.id, new Vector3d(90, 0, 0), data.customParams);\n      }\n    } else {\n      if (selectedItem.isWallItem) {\n        roomPreviewer.addWallItemIntoRoom(selectedItem.type, new Vector3d(90), furnitureItem.stuffData.getLegacyString());\n      } else {\n        roomPreviewer.addFurnitureIntoRoom(selectedItem.type, new Vector3d(90), selectedItem.stuffData, furnitureItem.extra.toString());\n      }\n    }\n  }, [roomPreviewer, selectedItem]);\n  useEffect(() => {\n    if (!selectedItem || !selectedItem.hasUnseenItems) return;\n    resetItems(UnseenItemCategory.FURNI, selectedItem.items.map(item => item.id));\n    selectedItem.hasUnseenItems = false;\n  }, [selectedItem, resetItems]);\n  useEffect(() => {\n    if (!isVisible) return;\n    const id = activate();\n    return () => deactivate(id);\n  }, [isVisible, activate, deactivate]);\n  useEffect(() => {\n    setIsVisible(true);\n    return () => setIsVisible(false);\n  }, []);\n  if (!groupItems || !groupItems.length) return /*#__PURE__*/_jsxDEV(InventoryCategoryEmptyView, {\n    title: LocalizeText('inventory.empty.title'),\n    desc: LocalizeText('inventory.empty.desc')\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 111,\n    columnNumber: 50\n  }, this);\n  return /*#__PURE__*/_jsxDEV(Grid, {\n    children: [/*#__PURE__*/_jsxDEV(Column, {\n      size: 7,\n      overflow: \"hidden\",\n      children: [/*#__PURE__*/_jsxDEV(InventoryFurnitureSearchView, {\n        groupItems: groupItems,\n        setGroupItems: setFilteredGroupItems\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(AutoGrid, {\n        columnCount: 5,\n        children: filteredGroupItems && filteredGroupItems.length > 0 && filteredGroupItems.map((item, index) => /*#__PURE__*/_jsxDEV(InventoryFurnitureItemView, {\n          groupItem: item\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 120\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Column, {\n      size: 5,\n      overflow: \"auto\",\n      children: [/*#__PURE__*/_jsxDEV(Column, {\n        overflow: \"hidden\",\n        position: \"relative\",\n        children: [/*#__PURE__*/_jsxDEV(LayoutRoomPreviewerView, {\n          roomPreviewer: roomPreviewer,\n          height: 140\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 21\n        }, this), selectedItem && selectedItem.stuffData.isUnique && /*#__PURE__*/_jsxDEV(LayoutLimitedEditionCompactPlateView, {\n          className: \"top-2 end-2\",\n          position: \"absolute\",\n          uniqueNumber: selectedItem.stuffData.uniqueNumber,\n          uniqueSeries: selectedItem.stuffData.uniqueSeries\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 25\n        }, this), selectedItem && selectedItem.stuffData.rarityLevel > -1 && /*#__PURE__*/_jsxDEV(LayoutRarityLevelView, {\n          className: \"top-2 end-2\",\n          position: \"absolute\",\n          level: selectedItem.stuffData.rarityLevel\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }, this), selectedItem && /*#__PURE__*/_jsxDEV(Column, {\n        grow: true,\n        justifyContent: \"between\",\n        gap: 2,\n        children: [/*#__PURE__*/_jsxDEV(Text, {\n          grow: true,\n          truncate: true,\n          children: selectedItem.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Column, {\n          gap: 1,\n          children: [!!roomSession && /*#__PURE__*/_jsxDEV(Button, {\n            onClick: event => attemptItemPlacement(selectedItem),\n            children: LocalizeText('inventory.furni.placetoroom')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 33\n          }, this), selectedItem && selectedItem.isSellable && /*#__PURE__*/_jsxDEV(Button, {\n            onClick: event => attemptPlaceMarketplaceOffer(selectedItem),\n            children: LocalizeText('inventory.marketplace.sell')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 114,\n    columnNumber: 9\n  }, this);\n};\n\n_s(InventoryFurnitureView, \"VbU5zXoUPQ71oH6KmhQVPy6hfcY=\", false, function () {\n  return [useInventoryFurni, useInventoryUnseenTracker];\n});\n\n_c = InventoryFurnitureView;\n\nvar _c;\n\n$RefreshReg$(_c, \"InventoryFurnitureView\");","map":{"version":3,"sources":["/var/www/game.bobba.ca/src/components/inventory/views/furniture/InventoryFurnitureView.tsx"],"names":["RoomObjectVariable","Vector3d","useEffect","useState","attemptItemPlacement","FurniCategory","GetRoomEngine","GetSessionDataManager","LocalizeText","UnseenItemCategory","AutoGrid","Button","Column","Grid","LayoutLimitedEditionCompactPlateView","LayoutRarityLevelView","LayoutRoomPreviewerView","Text","CatalogPostMarketplaceOfferEvent","DispatchUiEvent","useInventoryFurni","useInventoryUnseenTracker","InventoryCategoryEmptyView","InventoryFurnitureItemView","InventoryFurnitureSearchView","attemptPlaceMarketplaceOffer","groupItem","item","getLastItem","sellable","InventoryFurnitureView","props","roomSession","roomPreviewer","isVisible","setIsVisible","filteredGroupItems","setFilteredGroupItems","groupItems","selectedItem","activate","deactivate","resetItems","furnitureItem","roomEngine","wallType","getRoomInstanceVariable","activeRoomId","ROOM_WALL_TYPE","floorType","ROOM_FLOOR_TYPE","landscapeType","ROOM_LANDSCAPE_TYPE","length","reset","updateObjectRoom","updateRoomWallsAndFloorVisibility","category","WALL_PAPER","FLOOR","LANDSCAPE","stuffData","getLegacyString","data","getWallItemDataByName","addWallItemIntoRoom","id","customParams","isWallItem","type","addFurnitureIntoRoom","extra","toString","hasUnseenItems","FURNI","items","map","index","isUnique","uniqueNumber","uniqueSeries","rarityLevel","name","event","isSellable"],"mappings":"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","sourcesContent":["import { IRoomSession, RoomObjectVariable, RoomPreviewer, Vector3d } from '@nitrots/nitro-renderer';\nimport { FC, useEffect, useState } from 'react';\nimport { attemptItemPlacement, FurniCategory, GetRoomEngine, GetSessionDataManager, GroupItem, LocalizeText, UnseenItemCategory } from '../../../../api';\nimport { AutoGrid, Button, Column, Grid, LayoutLimitedEditionCompactPlateView, LayoutRarityLevelView, LayoutRoomPreviewerView, Text } from '../../../../common';\nimport { CatalogPostMarketplaceOfferEvent } from '../../../../events';\nimport { DispatchUiEvent, useInventoryFurni, useInventoryUnseenTracker } from '../../../../hooks';\nimport { InventoryCategoryEmptyView } from '../InventoryCategoryEmptyView';\nimport { InventoryFurnitureItemView } from './InventoryFurnitureItemView';\nimport { InventoryFurnitureSearchView } from './InventoryFurnitureSearchView';\n\ninterface InventoryFurnitureViewProps\n{\n    roomSession: IRoomSession;\n    roomPreviewer: RoomPreviewer;\n}\n\nconst attemptPlaceMarketplaceOffer = (groupItem: GroupItem) =>\n{\n    const item = groupItem.getLastItem();\n\n    if(!item) return false;\n\n    if(!item.sellable) return false;\n\n    DispatchUiEvent(new CatalogPostMarketplaceOfferEvent(item));\n}\n\nexport const InventoryFurnitureView: FC<InventoryFurnitureViewProps> = props =>\n{\n    const { roomSession = null, roomPreviewer = null } = props;\n    const [ isVisible, setIsVisible ] = useState(false);\n    const [ filteredGroupItems, setFilteredGroupItems ] = useState<GroupItem[]>([]);\n    const { groupItems = [], selectedItem = null, activate = null, deactivate = null } = useInventoryFurni();\n    const { resetItems = null } = useInventoryUnseenTracker();\n\n    useEffect(() =>\n    {\n        if(!selectedItem || !roomPreviewer) return;\n\n        const furnitureItem = selectedItem.getLastItem();\n\n        if(!furnitureItem) return;\n\n        const roomEngine = GetRoomEngine();\n\n        let wallType = roomEngine.getRoomInstanceVariable<string>(roomEngine.activeRoomId, RoomObjectVariable.ROOM_WALL_TYPE);\n        let floorType = roomEngine.getRoomInstanceVariable<string>(roomEngine.activeRoomId, RoomObjectVariable.ROOM_FLOOR_TYPE);\n        let landscapeType = roomEngine.getRoomInstanceVariable<string>(roomEngine.activeRoomId, RoomObjectVariable.ROOM_LANDSCAPE_TYPE);\n\n        wallType = (wallType && wallType.length) ? wallType : '101';\n        floorType = (floorType && floorType.length) ? floorType : '101';\n        landscapeType = (landscapeType && landscapeType.length) ? landscapeType : '1.1';\n\n        roomPreviewer.reset(false);\n        roomPreviewer.updateObjectRoom(floorType, wallType, landscapeType);\n        roomPreviewer.updateRoomWallsAndFloorVisibility(true, true);\n\n        if((furnitureItem.category === FurniCategory.WALL_PAPER) || (furnitureItem.category === FurniCategory.FLOOR) || (furnitureItem.category === FurniCategory.LANDSCAPE))\n        {\n            floorType = ((furnitureItem.category === FurniCategory.FLOOR) ? selectedItem.stuffData.getLegacyString() : floorType);\n            wallType = ((furnitureItem.category === FurniCategory.WALL_PAPER) ? selectedItem.stuffData.getLegacyString() : wallType);\n            landscapeType = ((furnitureItem.category === FurniCategory.LANDSCAPE) ? selectedItem.stuffData.getLegacyString() : landscapeType);\n\n            roomPreviewer.updateObjectRoom(floorType, wallType, landscapeType);\n\n            if(furnitureItem.category === FurniCategory.LANDSCAPE)\n            {\n                const data = GetSessionDataManager().getWallItemDataByName('noob_window_double');\n\n                if(data) roomPreviewer.addWallItemIntoRoom(data.id, new Vector3d(90, 0, 0), data.customParams);\n            }\n        }\n        else\n        {\n            if(selectedItem.isWallItem)\n            {\n                roomPreviewer.addWallItemIntoRoom(selectedItem.type, new Vector3d(90), furnitureItem.stuffData.getLegacyString());\n            }\n            else\n            {\n                roomPreviewer.addFurnitureIntoRoom(selectedItem.type, new Vector3d(90), selectedItem.stuffData, (furnitureItem.extra.toString()));\n            }\n        }\n    }, [ roomPreviewer, selectedItem ]);\n\n    useEffect(() =>\n    {\n        if(!selectedItem || !selectedItem.hasUnseenItems) return;\n\n        resetItems(UnseenItemCategory.FURNI, selectedItem.items.map(item => item.id));\n\n        selectedItem.hasUnseenItems = false;\n    }, [ selectedItem, resetItems ]);\n\n    useEffect(() =>\n    {\n        if(!isVisible) return;\n\n        const id = activate();\n\n        return () => deactivate(id);\n    }, [ isVisible, activate, deactivate ]);\n\n    useEffect(() =>\n    {\n        setIsVisible(true);\n\n        return () => setIsVisible(false);\n    }, []);\n\n    if(!groupItems || !groupItems.length) return <InventoryCategoryEmptyView title={ LocalizeText('inventory.empty.title') } desc={ LocalizeText('inventory.empty.desc') } />;\n\n    return (\n        <Grid>\n            <Column size={ 7 } overflow=\"hidden\">\n                <InventoryFurnitureSearchView groupItems={ groupItems } setGroupItems={ setFilteredGroupItems } />\n                <AutoGrid columnCount={ 5 }>\n                    { filteredGroupItems && (filteredGroupItems.length > 0) && filteredGroupItems.map((item, index) => <InventoryFurnitureItemView key={ index } groupItem={ item } />) }\n                </AutoGrid>\n            </Column>\n            <Column size={ 5 } overflow=\"auto\">\n                <Column overflow=\"hidden\" position=\"relative\">\n                    <LayoutRoomPreviewerView roomPreviewer={ roomPreviewer } height={ 140 } />\n                    { selectedItem && selectedItem.stuffData.isUnique &&\n                        <LayoutLimitedEditionCompactPlateView className=\"top-2 end-2\" position=\"absolute\" uniqueNumber={ selectedItem.stuffData.uniqueNumber } uniqueSeries={ selectedItem.stuffData.uniqueSeries } /> }\n                    { (selectedItem && selectedItem.stuffData.rarityLevel > -1) &&\n                        <LayoutRarityLevelView className=\"top-2 end-2\" position=\"absolute\" level={ selectedItem.stuffData.rarityLevel } /> }\n                </Column>\n                { selectedItem &&\n                    <Column grow justifyContent=\"between\" gap={ 2 }>\n                        <Text grow truncate>{ selectedItem.name }</Text>\n                        <Column gap={ 1 }>\n                            { !!roomSession &&\n                                <Button onClick={ event => attemptItemPlacement(selectedItem) }>\n                                    { LocalizeText('inventory.furni.placetoroom') }\n                                </Button> }\n                            { (selectedItem && selectedItem.isSellable) &&\n                                <Button onClick={ event => attemptPlaceMarketplaceOffer(selectedItem) }>\n                                    { LocalizeText('inventory.marketplace.sell') }\n                                </Button> }\n                        </Column>\n                    </Column> }\n            </Column>\n        </Grid>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}