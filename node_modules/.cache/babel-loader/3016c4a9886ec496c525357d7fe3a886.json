{"ast":null,"code":"import { ObjectDataFactory } from '../../../../room/object/data/ObjectDataFactory';\nimport { LegacyDataType } from '../../../../room/object/data/type/LegacyDataType';\nimport { MarketplaceOffer } from '../../incoming/marketplace/MarketplaceOffer';\nimport { FurnitureDataParser } from '../room/furniture/FurnitureDataParser';\nexport class MarketplaceOffersParser {\n  constructor() {\n    this.MAX_LIST_LENGTH = 500;\n    this._offers = void 0;\n    this._totalItemsFound = void 0;\n  }\n\n  flush() {\n    this._offers = [];\n    this._totalItemsFound = 0;\n    return true;\n  }\n\n  parse(wrapper) {\n    if (!wrapper) return false;\n    const count = wrapper.readInt();\n    let i = 0;\n\n    while (i < count) {\n      const offerId = wrapper.readInt();\n      const status = wrapper.readInt();\n      let furniType = wrapper.readInt();\n      let furniId = -1;\n      let extraData = '';\n      let stuffData = null;\n\n      if (furniType === MarketplaceOffersParser.FURNITYPE_STUFF) {\n        furniId = wrapper.readInt();\n        stuffData = FurnitureDataParser.parseObjectData(wrapper);\n      } else if (furniType === MarketplaceOffersParser.FURNITYPE_WALL) {\n        furniId = wrapper.readInt();\n        extraData = wrapper.readString();\n      } else if (furniType == MarketplaceOffersParser.FAKE_FURNITYPE_UNIQUE) {\n        furniId = wrapper.readInt();\n        stuffData = ObjectDataFactory.getData(LegacyDataType.FORMAT_KEY);\n        stuffData.uniqueNumber = wrapper.readInt();\n        stuffData.uniqueSeries = wrapper.readInt();\n        furniType = MarketplaceOffersParser.FURNITYPE_STUFF;\n      }\n\n      const price = wrapper.readInt();\n      const timeLeftMinutes = wrapper.readInt();\n      const averagePrice = wrapper.readInt();\n      const offerCount = wrapper.readInt();\n      const offerItem = new MarketplaceOffer(offerId, furniId, furniType, extraData, stuffData, price, status, timeLeftMinutes, averagePrice, offerCount);\n      if (i < this.MAX_LIST_LENGTH) this._offers.push(offerItem);\n      i++;\n    }\n\n    this._totalItemsFound = wrapper.readInt();\n    return true;\n  }\n\n  get offers() {\n    return this._offers;\n  }\n\n  get totalItemsFound() {\n    return this._totalItemsFound;\n  }\n\n}\nMarketplaceOffersParser.FURNITYPE_STUFF = 1;\nMarketplaceOffersParser.FURNITYPE_WALL = 2;\nMarketplaceOffersParser.FAKE_FURNITYPE_UNIQUE = 3;","map":{"version":3,"sources":["/var/www/game.bobba.ca/node_modules/@nitrots/nitro-renderer/src/nitro/communication/messages/parser/marketplace/MarketplaceOffersParser.ts"],"names":["ObjectDataFactory","LegacyDataType","MarketplaceOffer","FurnitureDataParser","MarketplaceOffersParser","MAX_LIST_LENGTH","_offers","_totalItemsFound","flush","parse","wrapper","count","readInt","i","offerId","status","furniType","furniId","extraData","stuffData","FURNITYPE_STUFF","parseObjectData","FURNITYPE_WALL","readString","FAKE_FURNITYPE_UNIQUE","getData","FORMAT_KEY","uniqueNumber","uniqueSeries","price","timeLeftMinutes","averagePrice","offerCount","offerItem","push","offers","totalItemsFound"],"mappings":"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","sourcesContent":["import { IMessageDataWrapper, IMessageParser } from '../../../../../core';\r\nimport { IObjectData } from '../../../../room/object/data/IObjectData';\r\nimport { ObjectDataFactory } from '../../../../room/object/data/ObjectDataFactory';\r\nimport { LegacyDataType } from '../../../../room/object/data/type/LegacyDataType';\r\nimport { MarketplaceOffer } from '../../incoming/marketplace/MarketplaceOffer';\r\nimport { FurnitureDataParser } from '../room/furniture/FurnitureDataParser';\r\n\r\nexport class MarketplaceOffersParser implements IMessageParser\r\n{\r\n    private static FURNITYPE_STUFF: number = 1;\r\n    private static FURNITYPE_WALL: number = 2;\r\n    private static FAKE_FURNITYPE_UNIQUE: number = 3;\r\n\r\n    private readonly MAX_LIST_LENGTH = 500;\r\n\r\n    private _offers: MarketplaceOffer[];\r\n    private _totalItemsFound: number;\r\n\r\n    public flush(): boolean\r\n    {\r\n        this._offers = [];\r\n        this._totalItemsFound = 0;\r\n\r\n        return true;\r\n    }\r\n\r\n    public parse(wrapper: IMessageDataWrapper): boolean\r\n    {\r\n        if(!wrapper) return false;\r\n\r\n        const count = wrapper.readInt();\r\n\r\n        let i = 0;\r\n\r\n        while(i < count)\r\n        {\r\n            const offerId = wrapper.readInt();\r\n            const status = wrapper.readInt();\r\n            let furniType = wrapper.readInt();\r\n\r\n            let furniId = -1;\r\n            let extraData = '';\r\n            let stuffData: IObjectData = null;\r\n\r\n            if(furniType === MarketplaceOffersParser.FURNITYPE_STUFF)\r\n            {\r\n                furniId = wrapper.readInt();\r\n                stuffData = FurnitureDataParser.parseObjectData(wrapper);\r\n            }\r\n\r\n            else if(furniType === MarketplaceOffersParser.FURNITYPE_WALL)\r\n            {\r\n                furniId = wrapper.readInt();\r\n                extraData = wrapper.readString();\r\n            }\r\n\r\n            else if(furniType == MarketplaceOffersParser.FAKE_FURNITYPE_UNIQUE)\r\n            {\r\n                furniId = wrapper.readInt();\r\n                stuffData = ObjectDataFactory.getData(LegacyDataType.FORMAT_KEY);\r\n                stuffData.uniqueNumber = wrapper.readInt();\r\n                stuffData.uniqueSeries = wrapper.readInt();\r\n                furniType = MarketplaceOffersParser.FURNITYPE_STUFF;\r\n            }\r\n\r\n            const price = wrapper.readInt();\r\n            const timeLeftMinutes = wrapper.readInt();\r\n            const averagePrice = wrapper.readInt();\r\n            const offerCount = wrapper.readInt();\r\n\r\n            const offerItem = new MarketplaceOffer(offerId, furniId, furniType, extraData, stuffData, price, status, timeLeftMinutes, averagePrice, offerCount);\r\n\r\n            if(i < this.MAX_LIST_LENGTH) this._offers.push(offerItem);\r\n\r\n            i++;\r\n        }\r\n\r\n        this._totalItemsFound = wrapper.readInt();\r\n\r\n        return true;\r\n    }\r\n\r\n    public get offers(): MarketplaceOffer[]\r\n    {\r\n        return this._offers;\r\n    }\r\n\r\n    public get totalItemsFound(): number\r\n    {\r\n        return this._totalItemsFound;\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}