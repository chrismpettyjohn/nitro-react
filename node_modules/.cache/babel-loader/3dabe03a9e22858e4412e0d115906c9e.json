{"ast":null,"code":"var _jsxFileName = \"/var/www/game.bobba.ca/src/components/camera/views/checkout/CameraWidgetCheckoutView.tsx\",\n    _s = $RefreshSig$();\n\nimport { CameraPublishStatusMessageEvent, CameraPurchaseOKMessageEvent, CameraStorageUrlMessageEvent, PublishPhotoMessageComposer, PurchasePhotoMessageComposer } from '@nitrots/nitro-renderer';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { CreateLinkEvent, GetConfiguration, GetRoomEngine, LocalizeText, SendMessageComposer } from '../../../../api';\nimport { Button, Column, Flex, LayoutCurrencyIcon, LayoutImage, NitroCardContentView, NitroCardHeaderView, NitroCardView, Text } from '../../../../common';\nimport { UseMessageEventHook } from '../../../../hooks';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const CameraWidgetCheckoutView = props => {\n  _s();\n\n  const {\n    base64Url = null,\n    onCloseClick = null,\n    onCancelClick = null,\n    price = null\n  } = props;\n  const [pictureUrl, setPictureUrl] = useState(null);\n  const [publishUrl, setPublishUrl] = useState(null);\n  const [picturesBought, setPicturesBought] = useState(0);\n  const [wasPicturePublished, setWasPicturePublished] = useState(false);\n  const [isWaiting, setIsWaiting] = useState(false);\n  const [publishCooldown, setPublishCooldown] = useState(0);\n  const publishDisabled = useMemo(() => GetConfiguration('camera.publish.disabled', false), []);\n  const onCameraPurchaseOKMessageEvent = useCallback(event => {\n    setPicturesBought(value => value + 1);\n    setIsWaiting(false);\n  }, []);\n  UseMessageEventHook(CameraPurchaseOKMessageEvent, onCameraPurchaseOKMessageEvent);\n  const onCameraPublishStatusMessageEvent = useCallback(event => {\n    const parser = event.getParser();\n    setPublishUrl(parser.extraDataId);\n    setPublishCooldown(parser.secondsToWait);\n    setWasPicturePublished(parser.ok);\n    setIsWaiting(false);\n  }, []);\n  UseMessageEventHook(CameraPublishStatusMessageEvent, onCameraPublishStatusMessageEvent);\n  const onCameraStorageUrlMessageEvent = useCallback(event => {\n    const parser = event.getParser();\n    setPictureUrl(GetConfiguration('camera.url') + '/' + parser.url);\n  }, []);\n  UseMessageEventHook(CameraStorageUrlMessageEvent, onCameraStorageUrlMessageEvent);\n\n  const processAction = function (type) {\n    let value = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n    switch (type) {\n      case 'close':\n        onCloseClick();\n        return;\n\n      case 'buy':\n        if (isWaiting) return;\n        setIsWaiting(true);\n        SendMessageComposer(new PurchasePhotoMessageComposer(''));\n        return;\n\n      case 'publish':\n        if (isWaiting) return;\n        setIsWaiting(true);\n        SendMessageComposer(new PublishPhotoMessageComposer());\n        return;\n\n      case 'cancel':\n        onCancelClick();\n        return;\n    }\n  };\n\n  useEffect(() => {\n    if (!base64Url) return;\n    GetRoomEngine().saveBase64AsScreenshot(base64Url);\n  }, [base64Url]);\n  if (!price) return null;\n  return /*#__PURE__*/_jsxDEV(NitroCardView, {\n    className: \"nitro-camera-checkout\",\n    theme: \"primary\",\n    children: [/*#__PURE__*/_jsxDEV(NitroCardHeaderView, {\n      headerText: LocalizeText('camera.confirm_phase.title'),\n      onCloseClick: event => processAction('close')\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(NitroCardContentView, {\n      children: [/*#__PURE__*/_jsxDEV(Flex, {\n        center: true,\n        children: [pictureUrl && pictureUrl.length && /*#__PURE__*/_jsxDEV(LayoutImage, {\n          className: \"picture-preview border\",\n          imageUrl: pictureUrl\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 25\n        }, this), (!pictureUrl || !pictureUrl.length) && /*#__PURE__*/_jsxDEV(Flex, {\n          center: true,\n          className: \"picture-preview border\",\n          children: /*#__PURE__*/_jsxDEV(Text, {\n            bold: true,\n            children: LocalizeText('camera.loading')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Flex, {\n        justifyContent: \"between\",\n        alignItems: \"center\",\n        className: \"bg-muted rounded p-2\",\n        children: [/*#__PURE__*/_jsxDEV(Column, {\n          size: publishDisabled ? 10 : 6,\n          gap: 1,\n          children: [/*#__PURE__*/_jsxDEV(Text, {\n            bold: true,\n            children: LocalizeText('camera.purchase.header')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 25\n          }, this), (price.credits > 0 || price.duckets > 0) && /*#__PURE__*/_jsxDEV(Flex, {\n            gap: 1,\n            children: [/*#__PURE__*/_jsxDEV(Text, {\n              children: LocalizeText('catalog.purchase.confirmation.dialog.cost')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 109,\n              columnNumber: 33\n            }, this), price.credits > 0 && /*#__PURE__*/_jsxDEV(Flex, {\n              gap: 1,\n              children: [/*#__PURE__*/_jsxDEV(Text, {\n                bold: true,\n                children: price.credits\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 112,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(LayoutCurrencyIcon, {\n                type: -1\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 113,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 111,\n              columnNumber: 37\n            }, this), price.duckets > 0 && /*#__PURE__*/_jsxDEV(Flex, {\n              gap: 1,\n              children: [/*#__PURE__*/_jsxDEV(Text, {\n                bold: true,\n                children: price.duckets\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 117,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(LayoutCurrencyIcon, {\n                type: 5\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 118,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 29\n          }, this), picturesBought > 0 && /*#__PURE__*/_jsxDEV(Text, {\n            children: [/*#__PURE__*/_jsxDEV(Text, {\n              bold: true,\n              children: LocalizeText('camera.purchase.count.info')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 33\n            }, this), \" \", picturesBought, /*#__PURE__*/_jsxDEV(\"u\", {\n              className: \"ms-1 cursor-pointer\",\n              onClick: () => CreateLinkEvent('inventory/open'),\n              children: LocalizeText('camera.open.inventory')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 124,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Flex, {\n          alignItems: \"center\",\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"success\",\n            disabled: isWaiting,\n            onClick: event => processAction('buy'),\n            children: LocalizeText(!picturesBought ? 'buy' : 'camera.buy.another.button.text')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 17\n      }, this), !publishDisabled && /*#__PURE__*/_jsxDEV(Flex, {\n        justifyContent: \"between\",\n        alignItems: \"center\",\n        className: \"bg-muted rounded p-2\",\n        children: [/*#__PURE__*/_jsxDEV(Column, {\n          gap: 1,\n          children: [/*#__PURE__*/_jsxDEV(Text, {\n            bold: true,\n            children: LocalizeText(wasPicturePublished ? 'camera.publish.successful' : 'camera.publish.explanation')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Text, {\n            children: LocalizeText(wasPicturePublished ? 'camera.publish.success.short.info' : 'camera.publish.detailed.explanation')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 137,\n            columnNumber: 25\n          }, this), wasPicturePublished && /*#__PURE__*/_jsxDEV(\"a\", {\n            href: publishUrl,\n            rel: \"noreferrer\",\n            target: \"_blank\",\n            children: LocalizeText('camera.link.to.published')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 50\n          }, this), !wasPicturePublished && price.publishDucketPrice > 0 && /*#__PURE__*/_jsxDEV(Flex, {\n            gap: 1,\n            children: [/*#__PURE__*/_jsxDEV(Text, {\n              children: LocalizeText('catalog.purchase.confirmation.dialog.cost')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 143,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(Flex, {\n              gap: 1,\n              children: [/*#__PURE__*/_jsxDEV(Text, {\n                bold: true,\n                children: price.publishDucketPrice\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 145,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(LayoutCurrencyIcon, {\n                type: 5\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 146,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 144,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 29\n          }, this), publishCooldown > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-1 text-center fw-bold\",\n            children: LocalizeText('camera.publish.wait', ['minutes'], [Math.ceil(publishCooldown / 60).toString()])\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 52\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 21\n        }, this), !wasPicturePublished && /*#__PURE__*/_jsxDEV(Flex, {\n          className: \"d-flex align-items-end\",\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"success\",\n            disabled: isWaiting || publishCooldown > 0,\n            onClick: event => processAction('publish'),\n            children: LocalizeText('camera.publish.button.text')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Text, {\n        center: true,\n        children: LocalizeText('camera.warning.disclaimer')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Flex, {\n        justifyContent: \"end\",\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          onClick: event => processAction('cancel'),\n          children: LocalizeText('generic.cancel')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 91,\n    columnNumber: 9\n  }, this);\n};\n\n_s(CameraWidgetCheckoutView, \"hI9v1Y8qlVFOlNDL6OsHpfdvMzE=\");\n\n_c = CameraWidgetCheckoutView;\n\nvar _c;\n\n$RefreshReg$(_c, \"CameraWidgetCheckoutView\");","map":{"version":3,"sources":["/var/www/game.bobba.ca/src/components/camera/views/checkout/CameraWidgetCheckoutView.tsx"],"names":["CameraPublishStatusMessageEvent","CameraPurchaseOKMessageEvent","CameraStorageUrlMessageEvent","PublishPhotoMessageComposer","PurchasePhotoMessageComposer","useCallback","useEffect","useMemo","useState","CreateLinkEvent","GetConfiguration","GetRoomEngine","LocalizeText","SendMessageComposer","Button","Column","Flex","LayoutCurrencyIcon","LayoutImage","NitroCardContentView","NitroCardHeaderView","NitroCardView","Text","UseMessageEventHook","CameraWidgetCheckoutView","props","base64Url","onCloseClick","onCancelClick","price","pictureUrl","setPictureUrl","publishUrl","setPublishUrl","picturesBought","setPicturesBought","wasPicturePublished","setWasPicturePublished","isWaiting","setIsWaiting","publishCooldown","setPublishCooldown","publishDisabled","onCameraPurchaseOKMessageEvent","event","value","onCameraPublishStatusMessageEvent","parser","getParser","extraDataId","secondsToWait","ok","onCameraStorageUrlMessageEvent","url","processAction","type","saveBase64AsScreenshot","length","credits","duckets","publishDucketPrice","Math","ceil","toString"],"mappings":"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","sourcesContent":["import { CameraPublishStatusMessageEvent, CameraPurchaseOKMessageEvent, CameraStorageUrlMessageEvent, PublishPhotoMessageComposer, PurchasePhotoMessageComposer } from '@nitrots/nitro-renderer';\nimport { FC, useCallback, useEffect, useMemo, useState } from 'react';\nimport { CreateLinkEvent, GetConfiguration, GetRoomEngine, LocalizeText, SendMessageComposer } from '../../../../api';\nimport { Button, Column, Flex, LayoutCurrencyIcon, LayoutImage, NitroCardContentView, NitroCardHeaderView, NitroCardView, Text } from '../../../../common';\nimport { UseMessageEventHook } from '../../../../hooks';\n\nexport interface CameraWidgetCheckoutViewProps\n{\n    base64Url: string;\n    onCloseClick: () => void;\n    onCancelClick: () => void;\n    price: { credits: number, duckets: number, publishDucketPrice: number };\n}\n\nexport const CameraWidgetCheckoutView: FC<CameraWidgetCheckoutViewProps> = props =>\n{\n    const { base64Url = null, onCloseClick = null, onCancelClick = null, price = null } = props;\n    const [ pictureUrl, setPictureUrl ] = useState<string>(null);\n    const [ publishUrl, setPublishUrl ] = useState<string>(null);\n    const [ picturesBought, setPicturesBought ] = useState(0);\n    const [ wasPicturePublished, setWasPicturePublished ] = useState(false);\n    const [ isWaiting, setIsWaiting ] = useState(false);\n    const [ publishCooldown, setPublishCooldown ] = useState(0);\n\n    const publishDisabled = useMemo(() => GetConfiguration<boolean>('camera.publish.disabled', false), []);\n\n    const onCameraPurchaseOKMessageEvent = useCallback((event: CameraPurchaseOKMessageEvent) =>\n    {\n        setPicturesBought(value => (value + 1));\n        setIsWaiting(false);\n    }, []);\n\n    UseMessageEventHook(CameraPurchaseOKMessageEvent, onCameraPurchaseOKMessageEvent);\n\n    const onCameraPublishStatusMessageEvent = useCallback((event: CameraPublishStatusMessageEvent) =>\n    {\n        const parser = event.getParser();\n\n        setPublishUrl(parser.extraDataId);\n        setPublishCooldown(parser.secondsToWait);\n        setWasPicturePublished(parser.ok);\n        setIsWaiting(false);\n    }, []);\n\n    UseMessageEventHook(CameraPublishStatusMessageEvent, onCameraPublishStatusMessageEvent);\n\n    const onCameraStorageUrlMessageEvent = useCallback((event: CameraStorageUrlMessageEvent) =>\n    {\n        const parser = event.getParser();\n\n        setPictureUrl(GetConfiguration<string>('camera.url') + '/' + parser.url);\n    }, []);\n\n    UseMessageEventHook(CameraStorageUrlMessageEvent, onCameraStorageUrlMessageEvent);\n\n    const processAction = (type: string, value: string | number = null) =>\n    {\n        switch(type)\n        {\n            case 'close':\n                onCloseClick();\n                return;\n            case 'buy':\n                if(isWaiting) return;\n\n                setIsWaiting(true);\n                SendMessageComposer(new PurchasePhotoMessageComposer(''));\n                return;\n            case 'publish':\n                if(isWaiting) return;\n\n                setIsWaiting(true);\n                SendMessageComposer(new PublishPhotoMessageComposer());\n                return;\n            case 'cancel':\n                onCancelClick();\n                return;\n        }\n    }\n\n    useEffect(() =>\n    {\n        if(!base64Url) return;\n\n        GetRoomEngine().saveBase64AsScreenshot(base64Url);\n    }, [ base64Url ]);\n\n    if(!price) return null;\n\n    return (\n        <NitroCardView className=\"nitro-camera-checkout\" theme=\"primary\">\n            <NitroCardHeaderView headerText={ LocalizeText('camera.confirm_phase.title') } onCloseClick={ event => processAction('close') } />\n            <NitroCardContentView>\n                <Flex center>\n                    { (pictureUrl && pictureUrl.length) &&\n                        <LayoutImage className=\"picture-preview border\" imageUrl={ pictureUrl } /> }\n                    { (!pictureUrl || !pictureUrl.length) &&\n                        <Flex center className=\"picture-preview border\">\n                            <Text bold>{ LocalizeText('camera.loading') }</Text>\n                        </Flex> }\n                </Flex>\n                <Flex justifyContent=\"between\" alignItems=\"center\" className=\"bg-muted rounded p-2\">\n                    <Column size={ publishDisabled ? 10 : 6 } gap={ 1 }>\n                        <Text bold>\n                            { LocalizeText('camera.purchase.header') }\n                        </Text>\n                        { ((price.credits > 0) || (price.duckets > 0)) &&\n                            <Flex gap={ 1 }>\n                                <Text>{ LocalizeText('catalog.purchase.confirmation.dialog.cost') }</Text>\n                                { (price.credits > 0) &&\n                                    <Flex gap={ 1 }>\n                                        <Text bold>{ price.credits }</Text>\n                                        <LayoutCurrencyIcon type={ -1 } />\n                                    </Flex> }\n                                { (price.duckets > 0) &&\n                                    <Flex gap={ 1 }>\n                                        <Text bold>{ price.duckets }</Text>\n                                        <LayoutCurrencyIcon type={ 5 } />\n                                    </Flex> }\n                            </Flex> }\n                        { (picturesBought > 0) &&\n                            <Text>\n                                <Text bold>{ LocalizeText('camera.purchase.count.info') }</Text> { picturesBought }\n                                <u className=\"ms-1 cursor-pointer\" onClick={ () => CreateLinkEvent('inventory/open') }>{ LocalizeText('camera.open.inventory') }</u>\n                            </Text> }\n                    </Column>\n                    <Flex alignItems=\"center\">\n                        <Button variant=\"success\" disabled={ isWaiting } onClick={ event => processAction('buy') }>{ LocalizeText(!picturesBought ? 'buy' : 'camera.buy.another.button.text') }</Button>\n                    </Flex>\n                </Flex>\n                { !publishDisabled &&\n                <Flex justifyContent=\"between\" alignItems=\"center\" className=\"bg-muted rounded p-2\">\n                    <Column gap={ 1 }>\n                        <Text bold>\n                            { LocalizeText(wasPicturePublished ? 'camera.publish.successful' : 'camera.publish.explanation') }\n                        </Text>\n                        <Text>\n                            { LocalizeText(wasPicturePublished ? 'camera.publish.success.short.info' : 'camera.publish.detailed.explanation') }\n                        </Text>\n                        { wasPicturePublished && <a href={ publishUrl } rel=\"noreferrer\" target=\"_blank\">{ LocalizeText('camera.link.to.published') }</a> }\n                        { !wasPicturePublished && (price.publishDucketPrice > 0) &&\n                            <Flex gap={ 1 }>\n                                <Text>{ LocalizeText('catalog.purchase.confirmation.dialog.cost') }</Text>\n                                <Flex gap={ 1 }>\n                                    <Text bold>{ price.publishDucketPrice }</Text>\n                                    <LayoutCurrencyIcon type={ 5 } />\n                                </Flex>\n                            </Flex> }\n                        { (publishCooldown > 0) && <div className=\"mt-1 text-center fw-bold\">{ LocalizeText('camera.publish.wait', [ 'minutes' ], [ Math.ceil( publishCooldown / 60).toString() ]) }</div> }\n                    </Column>\n                    { !wasPicturePublished &&\n                        <Flex className=\"d-flex align-items-end\">\n                            <Button variant=\"success\" disabled={ (isWaiting || (publishCooldown > 0)) } onClick={ event => processAction('publish') }>\n                                { LocalizeText('camera.publish.button.text') }\n                            </Button>\n                        </Flex> }\n                </Flex> }\n                <Text center>{ LocalizeText('camera.warning.disclaimer') }</Text>\n                <Flex justifyContent=\"end\">\n                    <Button onClick={ event => processAction('cancel') }>{ LocalizeText('generic.cancel') }</Button>\n                </Flex>\n            </NitroCardContentView>\n        </NitroCardView>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}