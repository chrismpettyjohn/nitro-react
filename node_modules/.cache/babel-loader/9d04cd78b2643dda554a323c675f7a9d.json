{"ast":null,"code":"import { AvatarAction } from '../../../../../avatar/enum/AvatarAction';\nexport class NumberBubbleAddition {\n  constructor(id, number, visualization) {\n    this._id = void 0;\n    this._visualization = void 0;\n    this._asset = void 0;\n    this._scale = void 0;\n    this._number = void 0;\n    this._numberValueFadeDirection = void 0;\n    this._numberValueMoving = void 0;\n    this._numberValueMoveCounter = void 0;\n    this._id = id;\n    this._visualization = visualization;\n    this._asset = null;\n    this._scale = 0;\n    this._number = number;\n    this._numberValueFadeDirection = 0;\n    this._numberValueMoving = false;\n    this._numberValueMoveCounter = 0;\n  }\n\n  dispose() {\n    this._visualization = null;\n    this._asset = null;\n  }\n\n  update(sprite, scale) {\n    if (!sprite) return;\n    this._scale = scale;\n    let additionScale = 64;\n    let offsetX = 0;\n    let offsetY = 0;\n\n    if (this._number > 0) {\n      if (scale < 48) {\n        this._asset = this._visualization.getAvatarRenderAsset('avatar_addition_number_' + this._number + '_small');\n        additionScale = 32;\n        offsetX = -6;\n        offsetY = -52;\n      } else {\n        this._asset = this._visualization.getAvatarRenderAsset('avatar_addition_number_' + this._number);\n        offsetX = -8;\n        offsetY = -105;\n      }\n\n      if (this._visualization.posture === AvatarAction.POSTURE_SIT) {\n        offsetY += additionScale / 2;\n      } else if (this._visualization.posture === AvatarAction.POSTURE_LAY) {\n        offsetY += scale;\n      }\n\n      if (this._asset) {\n        sprite.visible = true;\n        sprite.texture = this._asset;\n        sprite.offsetX = offsetX;\n        sprite.offsetY = offsetY;\n        sprite.relativeDepth = -0.01;\n        sprite.alpha = 0;\n        this._numberValueFadeDirection = 1;\n        this._numberValueMoving = true;\n        this._numberValueMoveCounter = 0;\n      } else {\n        sprite.visible = false;\n      }\n    } else {\n      if (sprite.visible) this._numberValueFadeDirection = -1;\n    }\n  }\n\n  animate(sprite) {\n    if (!sprite) return false;\n\n    if (this._asset) {\n      sprite.texture = this._asset;\n    }\n\n    let alpha = sprite.alpha;\n    let didAnimate = false;\n\n    if (this._numberValueMoving) {\n      this._numberValueMoveCounter++;\n      if (this._numberValueMoveCounter < 10) return false;\n\n      if (this._numberValueFadeDirection < 0) {\n        if (this._scale < 48) {\n          sprite.offsetY -= 2;\n        } else {\n          sprite.offsetY -= 4;\n        }\n      } else {\n        let count = 4;\n        if (this._scale < 48) count = 8;\n\n        if (!(this._numberValueMoveCounter % count)) {\n          sprite.offsetY--;\n          didAnimate = true;\n        }\n      }\n    }\n\n    if (this._numberValueFadeDirection > 0) {\n      if (alpha < 255) alpha += 32;\n\n      if (alpha >= 255) {\n        alpha = 255;\n        this._numberValueFadeDirection = 0;\n      }\n\n      sprite.alpha = alpha;\n      return true;\n    }\n\n    if (this._numberValueFadeDirection < 0) {\n      if (alpha >= 0) alpha -= 32;\n\n      if (alpha <= 0) {\n        this._numberValueFadeDirection = 0;\n        this._numberValueMoving = false;\n        alpha = 0;\n        sprite.visible = false;\n      }\n\n      sprite.alpha = alpha;\n      return true;\n    }\n\n    return didAnimate;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n}","map":{"version":3,"sources":["/var/www/game.bobba.ca/node_modules/@nitrots/nitro-renderer/src/nitro/room/object/visualization/avatar/additions/NumberBubbleAddition.ts"],"names":["AvatarAction","NumberBubbleAddition","constructor","id","number","visualization","_id","_visualization","_asset","_scale","_number","_numberValueFadeDirection","_numberValueMoving","_numberValueMoveCounter","dispose","update","sprite","scale","additionScale","offsetX","offsetY","getAvatarRenderAsset","posture","POSTURE_SIT","POSTURE_LAY","visible","texture","relativeDepth","alpha","animate","didAnimate","count"],"mappings":"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","sourcesContent":["import { Resource, Texture } from '@pixi/core';\r\nimport { IRoomObjectSprite } from '../../../../../../room/object/visualization/IRoomObjectSprite';\r\nimport { AvatarAction } from '../../../../../avatar/enum/AvatarAction';\r\nimport { AvatarVisualization } from '../AvatarVisualization';\r\nimport { IAvatarAddition } from './IAvatarAddition';\r\n\r\nexport class NumberBubbleAddition implements IAvatarAddition\r\n{\r\n    private _id: number;\r\n    private _visualization: AvatarVisualization;\r\n    private _asset: Texture<Resource>;\r\n    private _scale: number;\r\n    private _number: number;\r\n    private _numberValueFadeDirection: number;\r\n    private _numberValueMoving: boolean;\r\n    private _numberValueMoveCounter: number;\r\n\r\n    constructor(id: number, number: number, visualization: AvatarVisualization)\r\n    {\r\n        this._id = id;\r\n        this._visualization = visualization;\r\n        this._asset = null;\r\n        this._scale = 0;\r\n        this._number = number;\r\n        this._numberValueFadeDirection = 0;\r\n        this._numberValueMoving = false;\r\n        this._numberValueMoveCounter = 0;\r\n    }\r\n\r\n    public dispose(): void\r\n    {\r\n        this._visualization = null;\r\n        this._asset = null;\r\n    }\r\n\r\n    public update(sprite: IRoomObjectSprite, scale: number): void\r\n    {\r\n        if(!sprite) return;\r\n\r\n        this._scale = scale;\r\n\r\n        let additionScale = 64;\r\n        let offsetX = 0;\r\n        let offsetY = 0;\r\n\r\n        if(this._number > 0)\r\n        {\r\n            if(scale < 48)\r\n            {\r\n                this._asset = this._visualization.getAvatarRenderAsset('avatar_addition_number_' + this._number + '_small');\r\n\r\n                additionScale = 32;\r\n                offsetX = -6;\r\n                offsetY = -52;\r\n            }\r\n            else\r\n            {\r\n                this._asset = this._visualization.getAvatarRenderAsset('avatar_addition_number_' + this._number);\r\n\r\n                offsetX = -8;\r\n                offsetY = -105;\r\n            }\r\n\r\n            if(this._visualization.posture === AvatarAction.POSTURE_SIT)\r\n            {\r\n                offsetY += (additionScale / 2);\r\n            }\r\n\r\n            else if(this._visualization.posture === AvatarAction.POSTURE_LAY)\r\n            {\r\n                offsetY += scale;\r\n            }\r\n\r\n            if(this._asset)\r\n            {\r\n                sprite.visible = true;\r\n                sprite.texture = this._asset;\r\n                sprite.offsetX = offsetX;\r\n                sprite.offsetY = offsetY;\r\n                sprite.relativeDepth = -0.01;\r\n                sprite.alpha = 0;\r\n\r\n                this._numberValueFadeDirection = 1;\r\n                this._numberValueMoving = true;\r\n                this._numberValueMoveCounter = 0;\r\n            }\r\n            else\r\n            {\r\n                sprite.visible = false;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            if(sprite.visible) this._numberValueFadeDirection = -1;\r\n        }\r\n    }\r\n\r\n    public animate(sprite: IRoomObjectSprite): boolean\r\n    {\r\n        if(!sprite) return false;\r\n\r\n        if(this._asset)\r\n        {\r\n            sprite.texture = this._asset;\r\n        }\r\n\r\n        let alpha = sprite.alpha;\r\n        let didAnimate = false;\r\n\r\n        if(this._numberValueMoving)\r\n        {\r\n            this._numberValueMoveCounter++;\r\n\r\n            if(this._numberValueMoveCounter < 10) return false;\r\n\r\n            if(this._numberValueFadeDirection < 0)\r\n            {\r\n                if(this._scale < 48)\r\n                {\r\n                    sprite.offsetY -= 2;\r\n                }\r\n                else\r\n                {\r\n                    sprite.offsetY -= 4;\r\n                }\r\n            }\r\n            else\r\n            {\r\n                let count = 4;\r\n\r\n                if(this._scale < 48) count = 8;\r\n\r\n                if(!(this._numberValueMoveCounter % count))\r\n                {\r\n                    sprite.offsetY--;\r\n\r\n                    didAnimate = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        if(this._numberValueFadeDirection > 0)\r\n        {\r\n            if(alpha < 255) alpha += 32;\r\n\r\n            if(alpha >= 255)\r\n            {\r\n                alpha = 255;\r\n\r\n                this._numberValueFadeDirection = 0;\r\n            }\r\n\r\n            sprite.alpha = alpha;\r\n\r\n            return true;\r\n        }\r\n\r\n        if(this._numberValueFadeDirection < 0)\r\n        {\r\n            if(alpha >= 0) alpha -= 32;\r\n\r\n            if(alpha <= 0)\r\n            {\r\n                this._numberValueFadeDirection = 0;\r\n                this._numberValueMoving = false;\r\n\r\n                alpha = 0;\r\n\r\n                sprite.visible = false;\r\n            }\r\n\r\n            sprite.alpha = alpha;\r\n\r\n            return true;\r\n        }\r\n\r\n        return didAnimate;\r\n    }\r\n\r\n    public get id(): number\r\n    {\r\n        return this._id;\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}